var kona=0,search_value="",search_active=0,search_focus=0,requestTimer=!1,loadmore,nb_title=0,id="all",unr=0,d,m,varscroll=0,loadinprogress=0,zhr,totalItems=0,readItems=0,Now,favicon_badge,rtf;online=!0,notif=!1;var syncInterval=null,cacheVersion="v1",locallyModifiedArticles={},eventSource=null;const hasSupportLoading="loading"in HTMLImageElement.prototype;function showUpdateNotification(e){confirm("Une nouvelle version de Gheop Reader est disponible. Voulez-vous la charger maintenant ?")&&e.postMessage({type:"SKIP_WAITING"})}function updateOnlineStatus(){const e=document.getElementById("offline-indicator");e&&(navigator.onLine?(e.style.display="none",console.log("[App] Online")):(e.style.display="inline-block",console.log("[App] Offline")))}if("serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("[App] Service Worker registered:",e.scope),setInterval(()=>{e.update()},36e5),e.addEventListener("updatefound",()=>{const t=e.installing;console.log("[App] New Service Worker found"),t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&(console.log("[App] New Service Worker installed, update available"),showUpdateNotification(t))})})}).catch(e=>{console.error("[App] Service Worker registration failed:",e)}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("[App] Service Worker controller changed, reloading page"),window.location.reload()})}),window.clearServiceWorkerCache=async function(){if(!navigator.serviceWorker||!navigator.serviceWorker.controller)return void console.log("[App] No active Service Worker");const e=new MessageChannel;return new Promise((t,o)=>{e.port1.onmessage=e=>{e.data.success?(console.log("[App] Service Worker cache cleared"),t()):o(new Error("Failed to clear cache"))},navigator.serviceWorker.controller.postMessage({type:"CLEAR_CACHE"},[e.port2])})},window.addEventListener("load",updateOnlineStatus),window.addEventListener("online",updateOnlineStatus),window.addEventListener("offline",updateOnlineStatus),!/iPad|iPhone|iPod/.test(navigator.platform)){const e=navigator.language;rtf=new Intl.RelativeTimeFormat(e,{numeric:"auto"})}const D=document,DM=document.getElementsByTagName("main")[0];var cptReadArticle=0,imageObserver;function $(e){return D.getElementById(e)}function saveToCache(e){try{localStorage.setItem("reader_cache_"+cacheVersion,JSON.stringify(e)),localStorage.setItem("reader_cache_timestamp",Date.now())}catch(e){console.error("Failed to save to localStorage:",e)}}function loadFromCache(){try{const e=localStorage.getItem("reader_cache_"+cacheVersion);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load from localStorage:",e)}return null}function getCacheAge(){const e=localStorage.getItem("reader_cache_timestamp");return e?Date.now()-parseInt(e):1/0}function clearCache(){try{localStorage.removeItem("reader_cache_"+cacheVersion),localStorage.removeItem("reader_cache_timestamp")}catch(e){console.error("Failed to clear cache:",e)}}function loadData(e,t=!0){if(t){const t=loadFromCache();if(t&&t.menu&&t.articles){console.log("Loading from cache (age: "+Math.round(getCacheAge()/1e3)+"s)"),renderMenu(t.menu);var o="all"===e&&"all"!==id?id:e||"all";return renderArticles(t.articles,o),void setTimeout(()=>fetchAndUpdateData(e),100)}}console.log("No cache available, loading from server"),fetchAndUpdateData(e)}function fetchAndUpdateData(e){const t=e&&"all"!==e?"api.php?id="+e:"api.php";console.log("Fetching data from:",t),fetch(t).then(e=>{if(console.log("Response status:",e.status),!e.ok)throw new Error("HTTP error "+e.status);return e.json()}).then(t=>{if(console.log("Data received:",t),t.menu&&t.articles){console.log("Menu items:",Object.keys(t.menu).length),console.log("Articles:",Object.keys(t.articles).length),e&&"all"!==e?console.log("Skipping cache save for filtered feed",e):saveToCache(t),renderMenu(t.menu);var o="all"===e&&"all"!==id?id:e||"all";renderArticles(t.articles,o,!0)}else console.error("Invalid data structure:",t)}).catch(e=>{console.error("Failed to fetch data:",e),void 0!==affError&&affError("Erreur de chargement des donn√©es")})}let preloadedFeeds={},isPreloading=!1;function preloadFeedArticles(e){if(preloadedFeeds[e]||isPreloading)return void console.log("Preload skipped for feed",e,"- already preloaded:",!!preloadedFeeds[e],"isPreloading:",isPreloading);if(!m||!m[e]||0===m[e].n)return void console.log("Preload skipped for feed",e,"- no unread articles");console.log("=== PRELOADING feed",e,"with",m[e].n,"articles ==="),isPreloading=!0;fetch("api.php?id="+e+"&nb=200",{credentials:"same-origin"}).then(e=>{if(!e.ok)throw new Error("HTTP error "+e.status);return e.json()}).then(t=>{if(t.articles){console.log("PRELOAD: Received",Object.keys(t.articles).length,"articles for feed",e),d||(d={});let o=0;for(let e in t.articles)d[e]||(d[e]=t.articles[e],d[e].r=1,d[e].readblock=0,o++);console.log("PRELOAD: Added",o,"new articles to memory for feed",e),preloadedFeeds[e]=!0,m&&saveToCache({menu:m,articles:d,timestamp:Date.now()})}}).catch(t=>{console.error("Preload failed for feed",e,":",t)}).finally(()=>{isPreloading=!1})}function renderMenu(e){var t={},o={},n={};if(m)for(var a in m)t[a]=m[a].n||0,o[a]=m[a].n>0,readBatchQueue.length>0&&void 0!==t[a]&&(n[a]=!0);nb_title=0;var r=null;for(var a in"all"!==id&&m&&m[id]&&!e[id]&&(r=m[id],console.log("Preserving currently selected feed",id,"in menu")),e)m&&m[a]&&m[a].locallyModified&&m[a].n<e[a].n&&(console.log("Keeping local counter for feed",a,"- Local:",m[a].n,"Server:",e[a].n),e[a].n=m[a].n,e[a].locallyModified=!0);m=e,r&&(m[id]=r,m[id].n=0);var i='\t<li id="fsearch" class="flux" title="Recherche" onclick="return false;">R√©sultats de la recherche</li>\n',l=[],s=[],d={};for(var a in m){var c=id==a;if(m[a].n>0||c){d[a]=!0;var h=m[a].n>0?"fluxnew":"flux",u=m[a].n>0?'<span class="nb_flux"> '+m[a].n+"</span>":"";i+='\t<li id="f'+a+'" class="'+h+'" title="'+m[a].d+'" onclick="view('+a+');">'+m[a].t+u+' <span class="icon"><a title="Tout marquer comme lu" onclick="markallread('+a+')"></a> <a title="Se d√©sabonner" onclick="unsubscribe(\''+m[a].t.replace(/'/g,"\\'")+"', "+a+')"></a></span></li>\n',nb_title+=m[a].n||0,void 0!==t[a]&&t[a]!==m[a].n&&l.push(a);var f=r&&a==id;!1!==o[a]&&void 0!==o[a]||f||s.push(a)}}var p=s.length>0;if(!p&&o)for(var a in o)if(o[a]&&!d[a]){p=!0;break}const g=$("menu");if(p||g.children.length<=1){for(;g.children.length>1;)g.removeChild(g.lastChild);g.insertAdjacentHTML("beforeend",i)}else for(var a in l){var v=l[a],y=$("f"+v);if(y){var b=y.querySelector(".nb_flux");if(m[v].n>0){if(b)b.textContent=" "+m[v].n;else{y.firstChild;y.insertAdjacentHTML("afterbegin",y.textContent.split("<span")[0]+'<span class="nb_flux"> '+m[v].n+"</span>")}y.className="fluxnew"}else b&&b.remove(),y.className="flux"}}s.forEach(function(e){$("f"+e)&&($("f"+e).classList.add("fade-in-new"),setTimeout(()=>{$("f"+e)&&$("f"+e).classList.remove("fade-in-new")},600))}),l.forEach(function(e){$("f"+e)&&!s.includes(e)&&setTimeout(()=>light("f"+e),100)}),"all"===id&&$("fall")?$("fall").classList.add("show"):"all"!==id&&$("f"+id)&&$("f"+id).classList.add("show"),D.title="Gheop Reader"+(nb_title>0?" ("+nb_title+")":""),favicon(nb_title),totalItems=nb_title,readItems=0,progressBar()}function renderArticles(e,t,o=!1){console.log("renderArticles called with feedId:",t,"fromAPI:",o),console.log("articlesData keys:",Object.keys(e).length);let n="";cptReadArticle=0,varscroll=0,loadmore=0,d=e;for(let e in d)(o||void 0===d[e].r)&&(d[e].r=1,d[e].readblock=0);Now=new Date;for(let e in d)o||!t||"all"===t||d[e].f==t?0!==d[e].r?(loadmore++,n+=generateArticle(e)):console.log("Skipping read article",e):console.log("Skipping article",e,"feed:",d[e].f,"looking for:",t);console.log("Generated",loadmore,"articles"),0==loadmore&&(n='<article class="item1">\n\t<header>\n\t\t<h1 class="headline"><a class="title" target="_blank">Flux vide</a></h1>\n\t\t<div class="byline vcard">\n\t\t\t<address class="author"><a class="website">Gheop Reader</a></address>\n\t\t\t<time>Maintenant</time>\n\t\t</div>\n\t</header>\n\t<div class="article-content">Pas de nouveaux articles.</div>\n\t<div class="action">&nbsp;&nbsp;</div>\n</article>'),n+='<div id="addblank">&nbsp;</div>',DM.innerHTML=n,DM.scrollTop=0,DM.addEventListener("DOMMouseScroll",scroll,!1),DM.onscroll=scroll,DM.onmousewheel=scroll,DM.scrollTop=0,loadmore>0&&(loadmore&&($("addblank").style.height=DM.offsetHeight-60+"px"),scroll())}function startSSEConnection(){if(eventSource&&(eventSource.close(),eventSource=null),"undefined"==typeof EventSource)return console.warn("SSE not supported, falling back to polling"),void startBackgroundSync(30);console.log("Establishing SSE connection..."),(eventSource=new EventSource("sse.php")).addEventListener("connected",function(e){const t=JSON.parse(e.data);console.log("SSE connected:",t)}),eventSource.addEventListener("update",function(e){const t=JSON.parse(e.data);console.log("SSE update received:",t),fetchAndUpdateDataBackground()}),eventSource.addEventListener("heartbeat",function(e){const t=JSON.parse(e.data);console.log("SSE heartbeat:",t.timestamp)}),eventSource.addEventListener("timeout",function(e){console.log("SSE timeout, reconnecting..."),setTimeout(()=>startSSEConnection(),1e3)}),eventSource.onerror=function(e){console.error("SSE error:",e),eventSource.close(),eventSource=null,setTimeout(()=>startSSEConnection(),5e3)}}function stopSSEConnection(){eventSource&&(console.log("Closing SSE connection"),eventSource.close(),eventSource=null)}function startBackgroundSync(e=30){syncInterval&&clearInterval(syncInterval),syncInterval=setInterval(()=>{console.log("Background sync (polling)..."),fetchAndUpdateDataBackground()},1e3*e)}async function fetchAndUpdateDataBackground(){console.log("=== SSE BACKGROUND SYNC START ===");const e=Date.now()-lastReadActivity;if(e<2e3)return console.log("SSE: Recent read activity detected (",e,"ms ago), delaying sync for 2 seconds..."),void setTimeout(()=>fetchAndUpdateDataBackground(),2e3);console.log("SSE: No recent read activity, flushing pending read requests..."),await flushReadBatch(),console.log("SSE: Flush complete, now fetching data...");const t="api.php";console.log("Background fetching data from:",t),fetch(t,{credentials:"same-origin"}).then(e=>{if(!e.ok)throw new Error("HTTP error "+e.status);return e.json()}).then(e=>{e.menu&&e.articles&&(console.log("Background sync: Menu items:",Object.keys(e.menu).length,"Articles:",Object.keys(e.articles).length),saveToCache(e),renderMenu(e.menu),appendNewArticles(e.articles))}).catch(e=>{console.error("Background sync failed:",e)})}function appendNewArticles(e){var t=[],o=[],n=[];for(var a in e)"all"!==id&&e[a].f!=id||($(a)&&"item0"===$(a).className?n.push(a):d&&d[a]||$(a)||t.push(a));if(d)for(var a in d)e[a]||$(a)&&o.push(a);console.log("SSE: Found",t.length,"new articles,",n.length,"reactivated articles, and",o.length,"removed articles for current view");var r=Object.keys(e).length,i=d?Object.keys(d).length:0;for(var a in console.log("SSE: Old data had",i,"articles, new data has",r,"articles"),e)e[a].r=1,e[a].readblock=0;for(var a in locallyModifiedArticles)d&&d[a]&&(e[a]=d[a],console.log("SSE: Preserving locally modified article",a));if(d){var l=0;for(var a in d)e[a]||!$(a)||locallyModifiedArticles[a]||(e[a]=d[a],l++);console.log("SSE: Preserved",l,"read articles from DOM")}if(d=e,console.log("SSE: Updated global data object to",Object.keys(d).length,"articles"),o.length>0&&(o.forEach(function(e){if(locallyModifiedArticles[e])console.log("Skipping article",e,"- locally modified");else{var t=$(e);t&&(t.className="item0",d[e]&&(d[e].r=0))}}),console.log("Marked",o.length,"articles as read (from other device)"),"all"!==id)){var s=!1;for(var a in d)if(d[a].f==id){s=!0;break}if(console.log("Checking if feed",id,"has unread articles:",s),!s){console.log('Current feed has no more unread articles, switching to "All"');var c=$("f"+id);c&&c.classList.remove("show"),id="all",$("fall")&&$("fall").classList.add("show"),renderArticles(d,"all")}}n.length>0&&(console.log("SSE: Processing",n.length,"reactivated articles:",n.join(", ")),DM.querySelectorAll("article").forEach(function(e){var t=e.querySelector(".title");t&&"Flux vide"===t.textContent&&(console.log('SSE: Removing "Flux vide" message (reactivated articles)'),e.remove())}),n.forEach(function(e){var t=$(e);t&&"item0"===t.className&&(t.className="item1",console.log("SSE: Reactivated article",e,"from read to unread (feed:",d[e].f,")"),t.classList.add("fade-in-new"),setTimeout(()=>{$(e)&&$(e).classList.remove("fade-in-new")},600))}),console.log("SSE: Reactivated",n.length,"articles"));if(t.length>0){Now=new Date,DM.querySelectorAll("article").forEach(function(e){var t=e.querySelector(".title");t&&"Flux vide"===t.textContent&&(console.log('Removing "Flux vide" message'),e.remove())});var m=$("addblank");if(m){var h="";t.forEach(function(e){loadmore++,h+=generateArticle(e)}),m.insertAdjacentHTML("beforebegin",h),t.forEach(function(e){$(e)&&($(e).classList.add("fade-in-new"),$(e).dataset.newArticle="true",setTimeout(()=>{$(e)&&$(e).classList.remove("fade-in-new")},600))}),scroll(),setTimeout(()=>{t.forEach(function(e){$(e)&&delete $(e).dataset.newArticle})},2e3),console.log("Appended",t.length,"new articles to DOM")}}}function stopBackgroundSync(){syncInterval&&(clearInterval(syncInterval),syncInterval=null)}let readBatchQueue=[],readBatchTimeout=null,lastReadActivity=0,faviconTimeout;function flushReadBatch(){if(0===readBatchQueue.length)return Promise.resolve();const e=[...readBatchQueue];readBatchQueue=[],console.log("FLUSHING BATCH: Marking",e.length,"articles as read on server");return myFetch("read.php","ids="+e.join(","),1).then(()=>{for(var t in console.log("BATCH SUCCESS: Marked",e.length,"articles as read"),m)m[t].locallyModified&&(m[t].locallyModified=!1)}).catch(t=>{console.error("Batch read failed, retrying individually:",t),e.forEach(e=>myFetch("read.php","id="+e,1))})}function queueReadRequest(e){readBatchQueue.push(e),console.log("QUEUE: Article",e,"added to batch queue (",readBatchQueue.length,"in queue)"),lastReadActivity=Date.now(),clearTimeout(readBatchTimeout),readBatchQueue.length>=20?(console.log("QUEUE: Auto-flushing (20 items reached)"),flushReadBatch()):readBatchTimeout=setTimeout(flushReadBatch,500)}let lastFaviconUpdate=0;function favicon(e){if(e<0)return;const t=Date.now();clearTimeout(faviconTimeout),faviconTimeout=setTimeout(()=>{try{favicon_badge&&favicon_badge.badge(e)}catch(e){console.warn("Favicon update failed:",e.message)}lastFaviconUpdate=t},100)}function changeTheme(e){imageObserver&&imageObserver.disconnect();localStorage.getItem("theme");let t;t=$("stylesheet").href.includes("light.css")?"dark":$("stylesheet").href.includes("dark.css")?"adaptive":$("stylesheet").href.includes("adaptive.css")?"smooth":"light","light"===t?($("stylesheet").href="themes/light.min.css",localStorage.setItem("theme","light")):"dark"===t?($("stylesheet").href="themes/dark.min.css",localStorage.setItem("theme","dark")):"adaptive"===t?($("stylesheet").href="themes/adaptive.min.css",localStorage.setItem("theme","adaptive"),setTimeout(()=>{window.startAdaptiveTheme&&startAdaptiveTheme()},100)):"smooth"===t&&($("stylesheet").href="themes/adaptive-smooth.min.css",localStorage.setItem("theme","smooth"),setTimeout(()=>{window.startSmoothAdaptiveTheme&&startSmoothAdaptiveTheme()},100)),updateThemeIcon(),setTimeout(scroll,2e3)}function toggleThemeDropdown(){const e=$("theme-dropdown");e&&e.classList.toggle("theme-dropdown-hidden")}function selectTheme(e){const t=$("theme-dropdown");t&&t.classList.add("theme-dropdown-hidden"),imageObserver&&imageObserver.disconnect(),"light"===e?($("stylesheet").href="themes/light.min.css",localStorage.setItem("theme","light")):"dark"===e?($("stylesheet").href="themes/dark.min.css",localStorage.setItem("theme","dark")):"adaptive"===e?($("stylesheet").href="themes/adaptive.min.css",localStorage.setItem("theme","adaptive"),setTimeout(()=>{window.startAdaptiveTheme&&startAdaptiveTheme()},100)):"smooth"===e?($("stylesheet").href="themes/adaptive-smooth.min.css",localStorage.setItem("theme","smooth"),setTimeout(()=>{window.startSmoothAdaptiveTheme&&startSmoothAdaptiveTheme()},100)):"modern"===e&&($("stylesheet").href="themes/modern.min.css",localStorage.setItem("theme","modern")),updateThemeIcon(),setTimeout(scroll,2e3)}function updateThemeIcon(){const e=$("theme-current");if(!e)return;const t=$("stylesheet").href;let o="";t.includes("light.css")?o="theme-icon-light":t.includes("dark.css")?o="theme-icon-dark":t.includes("adaptive.css")?o="theme-icon-adaptive":t.includes("adaptive-smooth.css")?o="theme-icon-smooth":t.includes("modern.css")&&(o="theme-icon-modern"),e.innerHTML='<i class="'+o+'"></i>'}function handleConnectionChange(e){"offline"==e.type&&(online=!1,$("g").style.textDecoration="line-through",stopSSEConnection()),"online"==e.type&&(online=!0,$("g").style.textDecoration="none",startSSEConnection())}function getSelectedText(){return void 0!==window.getSelection?window.getSelection().trim():void 0!==document.selection?document.selection.createRange().text.trim():void 0}function search(e){if(e){search_value=e,$("bs").style.background="white url(i/loading.gif) no-repeat 4px center";var t=getHTTPObject("search");t.open("POST","https://reader.gheop.com/search.php",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send("xhr=1&s="+e),requestTimer=setTimeout(function(){t&&t.abort()},4e3),t=void 0,$("s").blur()}return e=void 0,!1}document.addEventListener("click",function(e){const t=$("theme-selector"),o=$("theme-dropdown");t&&o&&!t.contains(e.target)&&o.classList.add("theme-dropdown-hidden")});let lastRootHeight=0;function scroll(){let e=Array.from(document.getElementsByClassName("item1"));const t=DM.offsetHeight;let o=t-5;const n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);"IntersectionObserver"in window&&!n?($("addblank")&&($("addblank").style.height=t-60+"px"),imageObserver&&lastRootHeight===o?imageObserver.disconnect():(imageObserver&&imageObserver.disconnect(),lastRootHeight=o,imageObserver=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting||e.boundingClientRect.top<0&&e.rootBounds){let t=e.target;if("true"===t.dataset.newArticle)return;d[t.id]&&0!==d[t.id].r&&(imageObserver.unobserve(t),read(t.id),cptReadArticle++)}})},{root:DM,rootMargin:"0px 0px -"+o+"px 0px",threshold:[0,.01,1]})),e.forEach(function(e){imageObserver.observe(e)})):(DM.onscroll=oldScroll,DM.onmousewheel=oldScroll)}function oldScroll(){for(let e in d)if($(e)){if(!($(e).offsetTop<=DM.scrollTop))return;0!=d[e].r&&read(e)}}function goUp(){DM.scrollTop-=20}function goDown(){DM.scrollTop+=20}function goPrev(){if(1!=kona&&d){var e=void 0;for(var t in d)if($(t)){if($(t).offsetTop>DM.scrollTop-10)return void(e&&(DM.scrollTop=$(e).offsetTop-10));e=t}e&&(DM.scrollTop=$(e).offsetTop-10)}}function goNext(){if(1!=kona&&d){for(let e in d)if($(e)&&$(e).offsetTop>DM.scrollTop+10)return void(DM.scrollTop=$(e).offsetTop-10);$("addblank")&&(DM.scrollTop=$("addblank").offsetTop-20)}}function goPrevPage(){DM.scrollTop-=DM.offsetHeight}function goNextPage(){DM.scrollTop+=DM.offsetHeight}function delError(){$("error").style.display="none"}function likedArticle(e){var t=getHTTPObject("likedArticle");t.open("POST","likedArticle.php",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send("xhr=1&f="+e),requestTimer=setTimeout(function(){t&&t.abort()},4e3),t=void 0}function markallread(e){var t=confirm('Tout marquer comme lu pour "'+m[e].t+'" ?');if(t){var o=getHTTPObject("markallread");o.open("POST","markallread.php",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send("xhr=1&f="+e),requestTimer=setTimeout(function(){o&&o.abort()},4e3),o=void 0}return t=void 0,!1}function menu(){myFetch("menu.php").then(e=>{var t='\t<li id="fsearch" class="flux" title="Recherche" onclick="return false;">R√©sultats de la recherche</li>\n';for(var o in m=e)m[o].n>0&&(t+='\t<li id="f'+o+'" class="fluxnew" title="'+m[o].d+'" onclick="view('+o+');">'+m[o].t+'<span class="nb_flux"> '+m[o].n+'</span> <span class="icon"><a title="Tout marquer comme lu" onclick="markallread('+o+')">ÔÅÜ</a> <a title="Se d√©sabonner" onclick="unsubscribe(\''+m[o].t.replace(/'/g,"\\'")+"', "+o+')">Ôá∏</a></span></li>\n',nb_title+=m[o].n||0);$("menu").insertAdjacentHTML("beforeend",t),D.title="Gheop Reader"+(nb_title>0?" ("+nb_title+")":""),favicon(nb_title),totalItems=nb_title,readItems=0,progressBar()})}!function(){const e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);if(!("IntersectionObserver"in window)||e)return;let t,o,n=0,a=0;DM.addEventListener("scroll",function(){clearTimeout(t),t=setTimeout(function(){const e=DM.scrollTop;if(e>n){let o=Array.from(document.getElementsByClassName("item1"));var t=0;o.forEach(function(o){o.offsetTop<e&&d[o.id]&&0!==d[o.id].r&&(imageObserver&&imageObserver.unobserve(o),read(o.id),cptReadArticle++,t++)}),t>0&&console.log("FALLBACK: Marked",t,"missed articles as read")}n=e,clearTimeout(o),o=setTimeout(function(){const e=Date.now();if(e-a<2e3)return;const t=DM.scrollTop+DM.clientHeight,o=DM.scrollHeight,n=$("addblank");if(t>=o-50&&n){const o=Array.from(document.querySelectorAll(".item1, .item0"));if(o.length>0){const n=o[o.length-1],r=n.offsetTop,i=n.offsetHeight,l=r+i,s=Math.max(r,DM.scrollTop),d=(Math.min(l,t)-s)/i*100;if(d>0&&d<40){a=e;const t=r-10;DM.style.scrollBehavior="smooth",DM.scrollTop=t,setTimeout(()=>{DM.style.scrollBehavior=""},500)}}}},150)},100)},{passive:!0}),window.addEventListener("resize",scroll,{passive:!0}),window.addEventListener("orientationchange",scroll,{passive:!0})}();const articleStyleSheet=new CSSStyleSheet;function view(e){console.log("=== VIEW FEED",e,"==="),console.log("Menu counter for feed:",m&&m[e]?m[e].n:"N/A");var t=$("f"+id);t&&t.classList.remove("show");var o=$("f"+(id=e));o&&o.classList.add("show"),$("fsearch")&&($("fsearch").className="flux"),search_active=0;var n=!1,a=0,r=0;if(d)for(var i in d)"all"!==e&&d[i].f!=e||(1===d[i].r?(n=!0,a++):0===d[i].r&&r++);if(console.log("Articles in memory for feed",e,"- Unread:",a,"Read:",r),!n&&m&&m[e]&&m[e].n>0)return console.log("Feed",e,"has",m[e].n,"articles in menu but none in d, loading feed-specific data"),void loadData(e,!1);if(d&&Object.keys(d).length>0)renderArticles(d,e),"all"!==e&&m&&m[e]&&m[e].n>a&&(console.log("Feed",e,"has more articles in menu (",m[e].n,") than in memory (",a,"), triggering preload after 1 second..."),setTimeout(()=>preloadFeedArticles(e),1e3));else{const t=loadFromCache();t&&t.articles&&(renderArticles(t.articles,e),"all"!==e&&m&&m[e]&&m[e].n>0&&(console.log("Feed",e,"loaded from cache, triggering preload after 1 second..."),setTimeout(()=>preloadFeedArticles(e),1e3)))}}function removelight(e){$(e).classList.remove("blink")}function light(e){$(e).classList.add("blink"),setTimeout('removelight("'+e+'");',250)}function addflux(){var e=window.prompt("Ajouter le flux :","http(s)://");affError("R√©cup√©ration du flux '"+e+"' en cours ...",10);var t=getHTTPObject("addflux");t.open("POST","https://reader.gheop.com/add_flux.php",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send("xhr=1&link="+encodeURIComponent(e)),requestTimer=setTimeout(function(){t&&t.abort()},1e4),e=t=void 0}function up(){var e=getHTTPObject("up");return $("up").style.display="inline-block",$("up").style.animation="spin 4s infinite linear",$("up").style.color="red",e.open("POST","up_parallel.php",!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send("xhr=1"),requestTimer=setTimeout(function(){e&&e.abort()},1e4),e=void 0,!1}function unsubscribe(e,t){if(confirm('Se d√©sinscrire de "'+e+'" ?')){for(var o in myFetch("unsubscribe_flux.php","link="+t,1),d)d[o].f==t&&(d[o].r=0,$(o)&&($(o).style.display="none"));"fluxnew show"==$("f"+t).className&&view("all"),$("f"+t).className="flux"}return!1}function editFluxName(e){$("f"+e).innerHTML='<input id="focus'+e+'" type="text" value="'+m[e].t+'" />',$("focus"+e).focus()}function dateArticle(e){if(null==rtf)return e;var t=new Date(e)-Now,o=Math.round(t/864e5),n=Math.round(t/36e5),a=Math.round(t/6e4);return a>-46?rtf.format(a,"minute"):n>-24?rtf.format(n,"hour"):o>-32?rtf.format(o,"day"):e}function summarize(e){console.log("get summarize for article "+e),$("sum"+e).style.display="none",$("ac"+e).shadowRoot.innerHTML+='<hr /><div id="loader'+e+'" style="display: block;"><div class="spinner"></div></div>',updateStyle($("ac"+e));let t=new FormData;t.append("article",$("ac"+e).shadowRoot.children[0].innerText),fetch("https://reader.gheop.com/summarize.php",{method:"POST",body:t}).then(e=>e.text()).then(t=>{const o=(new DOMParser).parseFromString(t,"text/html");$("ac"+e).shadowRoot.querySelector("#loader"+e).innerHTML=o.querySelector("html").innerHTML,$("sum"+e).style.display="none"}).catch(e=>{console.error("Failed to fetch page: ",e)})}function readability(e){console.log("fetch https://reader.gheop.com/readability/?output&url="+d[e].l),fetch("https://reader.gheop.com/readability/?output&url="+d[e].l).then(e=>e.text()).then(t=>{const o=(new DOMParser).parseFromString(t,"text/html");$("ac"+e).shadowRoot.children[0].innerHTML+=o.querySelector("html").innerHTML,countWords($("ac"+e)),$("full"+e).style.display="none"}).catch(e=>{console.error("Failed to fetch page: ",e)})}function tagIt(e){let t=new FormData;t.append("article",$("ac"+e).shadowRoot.children[0].innerText),console.log("fetch https://reader.gheop.com/tagIt.php?text="+t),fetch("https://reader.gheop.com/tagIt.php?text="+t).then(e=>e.text()).then(t=>{const o=(new DOMParser).parseFromString(t,"text/html");$("tag"+e).innerHTML=o.querySelector("html").innerHTML}).catch(e=>{console.error("Failed to fetch page: ",e)})}function countWords(e){const t=(e.shadowRoot.innerText||e.shadowRoot.textContent).trim();if(""===t)return 0;const o=t.split(/\s+/).length;$("sum"+e.id.substring(2)).style.display=o<100?"none":"inline"}function generateArticle(e){let t=dateArticle(d[e].p);return'<article id="'+e+'" class="item1" onclick="read(this.id, 1)">\n\t<header>\n\t\t<h1 class="headline"><a href="'+d[e].l+'" class="title" target="_blank" title="'+d[e].t+'">'+d[e].t+'</a></h1>\n\t\t<div class="byline vcard">\n\t\t\t<address class="author">From <a href="'+d[e].o+'" title="'+d[e].n+'" class="website">'+d[e].n+"</a>"+(d[e].a?' <a rel="author" class="nickname">'+d[e].a+"</a>":"")+'</address>\n\t\t\t<time pubdate datetime="'+d[e].p+'" title="'+t+'">'+t+'</time>\n\t\t</div>\n\t</header>\n\t<article-content id="ac'+e+'"><div class="article-content">'+d[e].d+'</div></article-content>\n\t<div class="action"><a class="lu" onclick="verif('+e+', 1);return true;" title="Lu"></a> <a id="full'+e+'" class="readability" onclick="readability('+e+')"></a> <a id="sum'+e+'" class="summarize" onclick="summarize('+e+')"></a> <a class="sendTo" onclick="sendTo('+e+')"></a><a class="print" onclick="printIt('+e+')"></a><span id="tag'+e+'" class="tags icon"><a onclick="tagIt('+e+')"></a></span></div>\n</article>'}function sendToKindle(e){const t=$("ac"+e).shadowRoot.children[0].innerHTML;if(!t)return void alert("Article introuvable");const o=new FormData;o.append("html",t.outerHTML),o.append("title",d[e].t||"Article RSS"),fetch("/send-to-kindle.php",{method:"POST",body:o}).then(e=>e.text()).then(e=>{alert("Article envoy√© sur le Kindle !"),console.log(e)}).catch(e=>{alert("Erreur lors de l'envoi"),console.error(e)})}function printIt(e){let t=$("ac"+e).shadowRoot.children[0].innerHTML;if(!t)return;let o=d[e].t;const n=document.createElement("iframe");n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n);const a=n.contentWindow.document;a.open(),a.write(`\n    <html>\n      <head>\n        <title>${o}</title>\n        <style>\n          body { font-family: sans-serif; padding: 2em; }\n          article { max-width: 800px; margin: auto; }\n        </style>\n      </head>\n      <body>${t}</body>\n    </html>\n  `),a.close(),n.onload=()=>{n.contentWindow.focus(),n.contentWindow.print(),setTimeout(()=>document.body.removeChild(n),1e3)}}async function myFetch(e,t,o){try{const n=await fetch(e,{method:"POST",body:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(o)return void await n.text();return await n.json()}catch(e){console.log("fetch failed",e)}}function getHTTPObject(e){let t=new XMLHttpRequest;return t.onreadystatechange=function(){if(4===t.readyState&&t.status&&200===t.status){var o="";if("addflux"===e)return t.responseText?affError(t.responseText):location.reload();if("unsubscribeflux"===e)return t.responseText?affError(t.responseText):location.reload();if("up"===e)location.reload();else if("more"===e){if(!t.responseText||"{}"==t.responseText)return 0;var n=JSON.parse(t.responseText);if(!n.i||0===n.i.length)return 0;DM.removeChild($("addblank")),cptReadArticle=0,Now=new Date;for(let e in n)loadmore++,d[e]=n[e],o+=generateArticle(e);o+='<div id="addblank">&nbsp;</div>',DM.insertAdjacentHTML("beforeend",o),$("addblank").style.height=DM.offsetHeight-60+"px",loadinprogress=0,n=void 0}else if("markallread"===e)location.reload();else if("search"===e){if(search_active=1,$("bs").style.background="white url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAAd0SU1FB9kCBxQkAPQ1ZpQAAAGrSURBVDjLjdRNiE5xFAbw372v14zvkEGsjLD20UghKTay1uykyEIWSpY2Stmp2dhMoWQ1USYbScrKhpKyGkVDNDaGfM21ed5ct/cOp/7dc+89/+c8z/k/9xYoUPkTu7EXm7EQM3iO+3jfp/6v6NTyJbiEY1iE13iXfB+O4BdeoAxo0Q+0yLqGCRxFt1GzChfDctR/xDncxY5ak7KW9+I8JjE8H9iagJ36R9Nek5u43FZUYicGcCv3ZQtYhTk8xFYsbgPcgGnM1jb1A+vFMwxifRtgmdOba1FR1WrhR8MhRRPwA9ZFdtlgVo9ewy34mn0a9inK+KrC4TA9EZvUZe7BweQHAvipoaKABXiVNYoHmeV1PMZbbMcmnIlHh/JuPHabCc7PurS1MfU4VmN5vozjYSdgE7iBFdlzG/u1zGlbvoaleIKnkTaEQ9iIjznhQVyNoiuYwli/wXdwEiOxU5W5vsQdPMLpzLMbT47F7NO4UPRhW9V+FgP4jO+NxiM4G6azebYMk50W+WWG/C12KRpefBO2u7AyDbuY6sxj5uYqatcCX3AvhzgcX479BrxnZh85IOwcAAAAAElFTkSuQmCC) no-repeat 4px center",$("fsearch").className="fluxnew",$("fsearch").innerHTML='R√©sultats de la recherche "'+search_value+'"',$("f"+id).classList.remove("show"),$("f"+(id="search")).classList.add("show"),loadmore=0,!t.responseText)return DM.innerHTML='<div id="0" class="item1">\n\t<a class="date" title="date">Maintenant</a>\n\t<a id="a0" href="#" class="title icon" target="_blank" title="Pas de r√©sultat.">ÔÄÇ Recherche "'+search_value+'"</a>\n\t<div class="author">From <a href="//gheop.com" title="reader gheop">Reader</a></div>\n\t<div class="descr">Pas de r√©sultat trouv√©!</div>\n\t<div class="action"><a class="search icon" onclick="return true;" title="Lu"></a>\x3c!-- <span class="tags icon">ÔÄ¨ tag1, tag2, tag3, tagsuperlongdelamortquitue</span> ‚ò∫ ‚òª ‚ô° ‚ô•--\x3e</div>\n</div>\n',!1;for(let e=0,n=(d=JSON.parse(t.responseText)).i.length;e<n;e++)loadmore++,o+='<div id="'+d.i[e].i+'" class="item1">\n\t<a class="date" title="date">'+d.i[e].p+'</a>\n\t<a id="a'+d.i[e].i+'" href="'+d.i[e].l+'" class="title icon" target="_blank" title="'+d.i[e].t+'">ÔÄÇ '+d.i[e].t+'</a>\n\t<div class="author">From <a href="//gheop.com" title="'+d.i[e].n+'">'+d.i[e].n+"</a>"+(d.i[e].a?" by "+d.i[e].a:"")+'</div>\n\t<div class="descr">'+d.i[e].d+'</div>\n\t<div class="action"><a class="search icon" onclick="verif('+e+');return true;" title="Lu"></a>\x3c!-- <span class="tags icon">ÔÄ¨ tag1, tag2, tag3, tagsuperlongdelamortquitue</span> ‚ò∫ ‚òª ‚ô° ‚ô•--\x3e</div>\n</div>\n';o+='<div id="addblank">&nbsp;</div>',DM.innerHTML=o,$("addblank").style.height=DM.offsetHeight-60+"px",DM.addEventListener("DOMMouseScroll",scroll,!1),DM.onscroll=scroll,DM.onmousewheel=scroll,DM.scrollTop=0}requestTimer&&clearTimeout(requestTimer),o=void 0}else 4===t.readyState&&affError("Le serveur n'a pas r√©pondu assez rapidement. Veuillez r√©essayer ult√©rieurement.");return 0},t}function verif(e,t=0){if(d&&d[e])return 1==t&&(0==d[e].readblock?d[e].readblock=1:d[e].readblock=0),0==d[e].r?unread(e):read(e);console.warn("Article "+e+" not found in data object, skipping")}function unread(e,t=0){if(d&&d[e]){if(unr=1,0===t&&(d[e].readblock=1),1===t&&(d[e].readblock=0),1!=d[e].r&&"item1"!=$(e).className){if(d[e].r=1,$(e).className="item1",locallyModifiedArticles[e]={state:"unread",timestamp:Date.now()},nb_title<0&&(nb_title=0),D.title="Gheop Reader"+(++nb_title>0?" ("+nb_title+")":""),myFetch("unread.php","id="+e,1),!m[d[e].f])return console.log("Feed",d[e].f,"not in menu, triggering delayed update"),setTimeout(()=>{console.log("Fetching updated data after unread action on missing feed"),fetchAndUpdateDataBackground()},300),favicon(nb_title),readItems--,void progressBar();m[d[e].f].n++,$("f"+d[e].f).children[0].innerHTML=m[d[e].f].n,$("f"+d[e].f).className="fluxnew",id==d[e].f&&($("f"+d[e].f).className="fluxnew show"),light("f"+d[e].f),favicon(nb_title),readItems--,progressBar()}}else console.warn("Article "+e+" not found in data object, skipping unread")}function read(e,t=0){d&&d[e]?1!=search_active&&1!=d[e].readblock&&0!==d[e].r&&(1!==unr?(d[e].r=0,$(e).className="item0",console.log("READ article",e,"feed:",d[e].f,"- Menu counter before:",m[d[e].f]?m[d[e].f].n:"N/A"),queueReadRequest(e),D.title="Gheop Reader"+(--nb_title>0?" ("+nb_title+")":""),nb_title<0&&(nb_title=0),favicon(nb_title),xhr=void 0,readItems++,progressBar(),m[d[e].f]?(m[d[e].f].n--,m[d[e].f].locallyModified=!0,console.log("Menu counter after:",m[d[e].f].n,"- Total in title:",nb_title),m[d[e].f].n>0?($("f"+d[e].f).children[0].innerHTML=m[d[e].f].n,light("f"+d[e].f)):($("f"+d[e].f).children[0].innerHTML="",id==d[e].f?$("f"+d[e].f).className="flux show":$("f"+d[e].f).className="flux")):console.log("Feed",d[e].f,"not in menu when marking as read, skipping menu update")):unr=0):console.warn("Article "+e+" not found in data object, skipping read")}function progressBar(){const e=document.getElementsByTagName("footer")[0];if(!e)return;if(!totalItems||0===totalItems)return void e.setAttribute("style","background: rgba(0,0,0,0.1) !important; position: fixed !important; bottom: 0 !important; left: 0 !important; right: 0 !important; height: 4px !important; z-index: 1001 !important; display: block !important; visibility: visible !important; opacity: 1 !important;");let t=(readItems||0)/totalItems*100;t>100&&(t=100),t<0&&(t=0);const o="linear-gradient(to right, #aaa 0%, #aaa "+t+"%, rgba(0,0,0,0.1) "+t+"%, rgba(0,0,0,0.1) 100%)";e.setAttribute("style","background: "+o+" !important; position: fixed !important; bottom: 0 !important; left: 0 !important; right: 0 !important; height: 4px !important; z-index: 1001 !important; display: block !important; visibility: visible !important; opacity: 1 !important;")}articleStyleSheet.replaceSync("\n    .article-content {\n  text-align: justify;\n  padding: 10px 10px 0 10px !important;\n}\n  .article-content > :last-child {\n  margin-bottom: 0 !important;\n}\n  /* Prevent images, videos from overflowing */\n  .article-content img,\n  .article-content video,\n  .article-content picture,\n  .article-content source {\n  max-width: 100% !important;\n  height: auto !important;\n}\n  /* YouTube iframes - maintain 16:9 aspect ratio */\n  .article-content iframe {\n  width: 100% !important;\n  max-width: 100% !important;\n  height: auto !important;\n  aspect-ratio: 16 / 9 !important;\n  border: none;\n}\n  /* Ensure pre/code blocks also don't overflow */\n  .article-content pre {\n  max-width: 100%;\n  overflow-x: auto;\n}\n  .spinner {\n  margin: 20px auto;\n  width: 20px;\n  height: 20px;\n  border: 4px solid #111;\n  border-top-color: #ff8b8b;\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n"),customElements.define("article-content",class extends HTMLElement{connectedCallback(){const e=this.attachShadow({mode:"open"});e.adoptedStyleSheets=[articleStyleSheet],e.innerHTML=this.innerHTML}});var pressedKeys=[],konamiCode=[38,38,40,40,37,39,37,39,66,65],konamiGameLoop;function konami(){DM.innerHTML='<div id="konami" class="item1"><div class="date">Now!</div><a id="game" class="title">Easter Egg - Dragon Fly - Hold any key to fly - Press ESC to exit</a><div class="author">From <a href="https://js1k.com/2014-dragons/demo/1955" target="_blank">js1k.com</a> by mouminoux</div><div class="descr"><canvas id="c" style="border: 2px solid #333; display: block; margin: 20px auto;"></canvas></div><div class="action">&nbsp;&nbsp;‚ò∫ ‚òª ‚ò∫ ‚òª </div></div>'+DM.innerHTML,$("konami").style.display="block",DM.scrollTop=0,kona=1;var a=$("c"),c=a.getContext("2d"),J,K,C,B,u,D,E,F,G,H,I,L,M,N,O,t,U,K2,Q,R,i;for(p in a.style.width=(a.width=1e3)+"px",a.style.height=(a.height=500)+"px",c)c[p[0]+(p[6]||"")]=c[p];J=K=C=B=0,u=50,D=250,E=F=G=H=1,I=250,konamiGameLoop=setInterval(function(){with(L=300,M=500,N=400,c){for(A=function(e,t,o,n){n&&a(t,o,n,0,7,0),fillStyle=e.P?e:"#"+"ceff99aaffff333f99ff7".substr(3*e,3),fill(),ba()},A(0,0,0,1e4),A(6,800,300,140),O=G*u%400,l(0-O,N+100),l(0-O,N),i=0;i<7;i++)qt(200*i+100-O,i%2?L:M,200*i+200-O,N);l(200*i-O,N+100),ca(),fillStyle="#5c1",fill(),ba(),t=(G*(u+E)+I)%200/200,U=1-t,K2=U*U*N+2*t*U*((G*(u+E)+I)%400>200?L:M)+t*t*N,D+=F,D>=K?(K2<K?(F>0&&K2-K<0&&!J&&(E/=3,K2=K),E-=E<2?0:.1):E+=.1*H*H,J=1,D=K,K2<K&&F>K2-K&&(F=K2-K)):J=0,F+=.4*H,K=K2,A(3-H,I,D-10,10),A(3,I+3,D-12,4),A(4,I+4,D-12,1),Q=200+Math.pow(B,1.3)-u,R=50+2*Math.sin(B/2),A(1,Q,R,30),A(3,Q+20,R+5,7),A(4,Q+22,R+7,2),A(6,0,0,0),fx(++B+" ‚òÜ",5,10),fx((C<B?C=B:C)+" ‚òÖ",40,10),Q>4*I&&(clearInterval(konamiGameLoop),setTimeout(function(){confirm("Game Over! Score: "+B+"\nBest: "+C+"\n\nPlay again?")&&(E=F=u=B=K=2,konamiGameLoop=setInterval(arguments.callee,30))},100))}u+=E},30),window.konamiKeyHandler=function(e){H=e.type[5]?2:1}}function konamistop(){kona=0,konamiGameLoop&&clearInterval(konamiGameLoop),$("konami")&&($("konami").style.display="none"),window.konamiKeyHandler=null}function i(){favicon_badge=new Favico({animation:"none"}),$("fall")&&$("fall").classList.add("show"),loadData("all"),startSSEConnection(),window.addEventListener("online",handleConnectionChange),window.addEventListener("offline",handleConnectionChange),window.addEventListener("beforeunload",stopSSEConnection),window.onresize=scroll,$("s").onfocus=function(){search_focus=1},$("s").onblur=function(){search_focus=0},D.onkeydown=function(e){if(1!==search_focus){var t=e.which?e.which:e.keyCode;if(1==kona)return 27==t?void konamistop():void(window.konamiKeyHandler&&window.konamiKeyHandler(e));switch(pressedKeys.length==konamiCode.length&&pressedKeys.shift(),pressedKeys.push(t),pressedKeys.toString()==konamiCode.toString()&&konami(),t){case 33:goPrevPage();break;case 34:goNextPage();break;case 78:case 39:goNext();break;case 80:case 37:goPrev();break;case 38:goUp();break;case 40:goDown();break;case 71:goGoogle();break;case 87:goWikipedia();break;case 79:openActif()}t=void 0}};const e=document.getElementById("menu-resizer"),t=document.querySelector("nav"),o=document.querySelector("main");let n=!1;e.addEventListener("mousedown",a=>{n=!0,document.body.classList.add("resizing");const r=a=>{if(!n)return;let r=a.clientX;r<20?(r=0,e.innerHTML="‚áπ",e.style.height="auto"):(e.innerHTML="",e.style.height="100%"),r>.6*window.innerWidth&&(r=.6*window.innerWidth),t.style.width=r+"px",e.style.left=r+"px",o.style.left=r+"px",localStorage.setItem("menuWidth",r)},i=()=>{n=!1,document.body.classList.remove("resizing"),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",i)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",i)}),window.addEventListener("DOMContentLoaded",()=>{const n=localStorage.getItem("menuWidth");n&&(t.style.width=parseInt(n)+"px",e.style.left=parseInt(n)+"px",n<20&&(e.innerHTML="‚áπ",e.style.height="auto"),o.style.left=parseInt(n)+"px")})}function openActif(){if(1!=kona&&d){for(var e=0,t=d.i.length;e<=t;e++){if(!d.i[e])return;if($(d.i[e].i).offsetTop>=DM.scrollTop)return window.focus(),window.open(d.i[e].l).blur(),window.self.focus(),void goNext()}e=t=void 0,log("Fen√™tre active non trouv√©e!")}}function goWikipedia(){var e=getSelectedText();return e&&""!==e&&window.open("//fr.wikipedia.org/wiki/Special:Search?search="+e),!1}function goGoogle(){var e=getSelectedText();return e&&""!==e&&window.open("https://www.google.fr/search?q="+e+"&ie=utf-8&oe=utf-8&lr=lang_fr"),!1}function more(){var e=getHTTPObject("more");e.open("POST","view.php",!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),id&&"all"!==id?e.send("xhr=1&nb=10&id="+id):e.send("xhr=1&nb=10"),requestTimer=setTimeout(function(){e&&e.abort()},4e3),e=void 0}function log(e){"undefined"!=typeof console&&("object"==typeof e?console.table(e):console.log(e))}function affError(e,t){t=void 0!==t?t:4,"Notification"in window?Notification.requestPermission(function(o){if("granted"===o){var n=new Notification("Gheop Reader",{body:e});setTimeout(function(){n.close()},1e3*t)}else notif=!0}):notif=!0,notif&&($("error").innerHTML=e,$("error").style.display="block",setTimeout(delError,1e3*t))}document.onload=i(),window.addEventListener("DOMContentLoaded",()=>{const e=localStorage.getItem("theme");"dark"===e?$("stylesheet").href="themes/dark.min.css":"light"===e?$("stylesheet").href="themes/light.min.css":"adaptive"===e?($("stylesheet").href="themes/adaptive.min.css",setTimeout(()=>{window.startAdaptiveTheme&&startAdaptiveTheme()},100)):"smooth"===e?($("stylesheet").href="themes/adaptive-smooth.min.css",setTimeout(()=>{window.startSmoothAdaptiveTheme&&startSmoothAdaptiveTheme()},100)):"modern"===e?$("stylesheet").href="themes/modern.min.css":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&($("stylesheet").href="themes/dark.min.css"),setTimeout(()=>{window.updateThemeIcon&&updateThemeIcon()},100)});const lightTheme={bgBody:"#ffffff",bgMain:"#eeeeee",bgItem:"#ffffff",bgShow:"#e8e8e8",bgInput:"#ffffff",textBody:"#1a1a1a",textLink:"#2a2a2a",textLight:"#666666",textWhite:"#333333",shadowItem:"rgba(0, 0, 0, 0.15)",border:"#dddddd"},darkTheme={bgBody:"#1a1a1a",bgMain:"#2b2b2b",bgItem:"#3a3a3a",bgShow:"#2b2b2b",bgInput:"#333333",textBody:"#e0e0e0",textLink:"#b8b8b8",textLight:"#999999",textWhite:"#f5f5f5",shadowItem:"rgba(0, 0, 0, 0.5)",border:"#4a4a4a"};function interpolateColor(e,t,o){if(e.startsWith("rgba")){const n=e.match(/[\d.]+/g).map(Number),a=t.match(/[\d.]+/g).map(Number);return`rgba(${Math.round(n[0]+(a[0]-n[0])*o)}, ${Math.round(n[1]+(a[1]-n[1])*o)}, ${Math.round(n[2]+(a[2]-n[2])*o)}, ${n[3]+(a[3]-n[3])*o})`}const n=e.replace("#",""),a=t.replace("#",""),r=parseInt(n.substr(0,2),16),i=parseInt(n.substr(2,2),16),l=parseInt(n.substr(4,2),16),s=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),c=parseInt(a.substr(4,2),16);return`rgb(${Math.round(r+(s-r)*o)}, ${Math.round(i+(d-i)*o)}, ${Math.round(l+(c-l)*o)})`}function calculateThemeIntensity(){const e=new Date,t=60*e.getHours()+e.getMinutes(),o=960;let n;if(t>=360&&t<600){n=1-(t-360)/240}else if(t>=600&&t<o)n=0;else if(t>=o&&t<1200){n=(t-o)/240}else n=1;return n}function applyAdaptiveTheme(){const e=calculateThemeIntensity(),t=document.documentElement;let o=e<=.5?0:1;t.style.setProperty("--adaptive-bg-body",interpolateColor(lightTheme.bgBody,darkTheme.bgBody,o)),t.style.setProperty("--adaptive-bg-main",interpolateColor(lightTheme.bgMain,darkTheme.bgMain,o)),t.style.setProperty("--adaptive-bg-item",interpolateColor(lightTheme.bgItem,darkTheme.bgItem,o)),t.style.setProperty("--adaptive-bg-show",interpolateColor(lightTheme.bgShow,darkTheme.bgShow,o)),t.style.setProperty("--adaptive-bg-input",interpolateColor(lightTheme.bgInput,darkTheme.bgInput,o)),t.style.setProperty("--adaptive-text-body",interpolateColor(lightTheme.textBody,darkTheme.textBody,o)),t.style.setProperty("--adaptive-text-link",interpolateColor(lightTheme.textLink,darkTheme.textLink,o)),t.style.setProperty("--adaptive-text-light",interpolateColor(lightTheme.textLight,darkTheme.textLight,o)),t.style.setProperty("--adaptive-text-white",interpolateColor(lightTheme.textWhite,darkTheme.textWhite,o)),t.style.setProperty("--adaptive-shadow-item",interpolateColor(lightTheme.shadowItem,darkTheme.shadowItem,o)),t.style.setProperty("--adaptive-border",interpolateColor(lightTheme.border,darkTheme.border,o)),t.style.setProperty("--theme-intensity",o);const n=new Date;console.log(`Adaptive theme: ${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")} - raw: ${e.toFixed(2)}, adjusted: ${o.toFixed(2)}`)}function startAdaptiveTheme(){applyAdaptiveTheme(),setInterval(applyAdaptiveTheme,3e5)}window.startAdaptiveTheme=startAdaptiveTheme,window.applyAdaptiveTheme=applyAdaptiveTheme;const smoothLightTheme={bgBody:"#faf7ef",bgMain:"#faf7ef",bgItem:"#ffffff",bgShow:"#eae4d5",bgInput:"#ffffff",textBody:"#1a0f08",textLink:"#7a3e0a",textLight:"#5c4a3a",shadowItem:"rgba(101, 67, 33, 0.15)",border:"#d4caba",accent:"#c65d1f"},smoothDarkTheme={bgBody:"#0f0b08",bgMain:"#1f1812",bgItem:"#2f2519",bgShow:"#1f1812",bgInput:"#292016",textBody:"#fff9ed",textLink:"#ffb366",textLight:"#d4c4ae",shadowItem:"rgba(0, 0, 0, 0.5)",border:"#4a3f2f",accent:"#ff9966"};function applySmoothAdaptiveTheme(){const e=calculateThemeIntensity(),t=document.documentElement,o=e;t.style.setProperty("--adaptive-bg-body",interpolateColor(smoothLightTheme.bgBody,smoothDarkTheme.bgBody,o)),t.style.setProperty("--adaptive-bg-main",interpolateColor(smoothLightTheme.bgMain,smoothDarkTheme.bgMain,o)),t.style.setProperty("--adaptive-bg-item",interpolateColor(smoothLightTheme.bgItem,smoothDarkTheme.bgItem,o)),t.style.setProperty("--adaptive-bg-show",interpolateColor(smoothLightTheme.bgShow,smoothDarkTheme.bgShow,o)),t.style.setProperty("--adaptive-bg-input",interpolateColor(smoothLightTheme.bgInput,smoothDarkTheme.bgInput,o)),t.style.setProperty("--adaptive-text-body",interpolateColor(smoothLightTheme.textBody,smoothDarkTheme.textBody,o)),t.style.setProperty("--adaptive-text-link",interpolateColor(smoothLightTheme.textLink,smoothDarkTheme.textLink,o)),t.style.setProperty("--adaptive-text-light",interpolateColor(smoothLightTheme.textLight,smoothDarkTheme.textLight,o)),t.style.setProperty("--adaptive-shadow-item",interpolateColor(smoothLightTheme.shadowItem,smoothDarkTheme.shadowItem,o)),t.style.setProperty("--adaptive-border",interpolateColor(smoothLightTheme.border,smoothDarkTheme.border,o)),t.style.setProperty("--adaptive-accent",interpolateColor(smoothLightTheme.accent,smoothDarkTheme.accent,o)),t.style.setProperty("--theme-intensity",o);const n=new Date;console.log(`Smooth adaptive theme: ${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")} - intensity: ${o.toFixed(2)} (progressive)`)}function startSmoothAdaptiveTheme(){applySmoothAdaptiveTheme(),setInterval(applySmoothAdaptiveTheme,3e5)}window.startSmoothAdaptiveTheme=startSmoothAdaptiveTheme,window.applySmoothAdaptiveTheme=applySmoothAdaptiveTheme,window.testAdaptiveThemeAt=function(e,t=0){if("number"!=typeof e||e<0||e>23)return console.error("‚ùå Heure invalide. Utilisez un nombre entre 0 et 23."),void console.log("üí° Exemple: testAdaptiveThemeAt(8, 30) pour tester √† 8h30");if("number"!=typeof t||t<0||t>59)return void console.error("‚ùå Minutes invalides. Utilisez un nombre entre 0 et 59.");if(!$("stylesheet").href.includes("adaptive.css"))return console.warn("‚ö†Ô∏è  Le th√®me adaptatif n'est pas activ√©. Changez de th√®me d'abord !"),void console.log("üí° Cliquez sur l'ic√¥ne de th√®me pour cycler jusqu'au mode adaptatif (ic√¥ne horloge)");const o=60*e+t,n=960;let a,r;if(o>=360&&o<600){a=1-(o-360)/240,r="üåÖ Transition matin (sombre ‚Üí clair)"}else if(o>=600&&o<n)a=0,r="‚òÄÔ∏è  Jour (clair)";else if(o>=n&&o<1200){a=(o-n)/240,r="üåÜ Transition soir (clair ‚Üí sombre)"}else a=1,r="üåô Nuit (sombre)";let i=a<=.5?0:1;console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"),console.log(`üïê Test √† ${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}`),console.log(`üìä Intensit√©: ${i.toFixed(2)} (0=clair, 1=sombre)`),console.log(`üé® Phase: ${r}`),console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ");const l=document.documentElement;l.style.setProperty("--adaptive-bg-body",interpolateColor(lightTheme.bgBody,darkTheme.bgBody,i)),l.style.setProperty("--adaptive-bg-main",interpolateColor(lightTheme.bgMain,darkTheme.bgMain,i)),l.style.setProperty("--adaptive-bg-item",interpolateColor(lightTheme.bgItem,darkTheme.bgItem,i)),l.style.setProperty("--adaptive-bg-show",interpolateColor(lightTheme.bgShow,darkTheme.bgShow,i)),l.style.setProperty("--adaptive-bg-input",interpolateColor(lightTheme.bgInput,darkTheme.bgInput,i)),l.style.setProperty("--adaptive-text-body",interpolateColor(lightTheme.textBody,darkTheme.textBody,i)),l.style.setProperty("--adaptive-text-link",interpolateColor(lightTheme.textLink,darkTheme.textLink,i)),l.style.setProperty("--adaptive-text-light",interpolateColor(lightTheme.textLight,darkTheme.textLight,i)),l.style.setProperty("--adaptive-text-white",interpolateColor(lightTheme.textWhite,darkTheme.textWhite,i)),l.style.setProperty("--adaptive-shadow-item",interpolateColor(lightTheme.shadowItem,darkTheme.shadowItem,i)),l.style.setProperty("--adaptive-border",interpolateColor(lightTheme.border,darkTheme.border,i)),l.style.setProperty("--theme-intensity",i),console.log("‚úÖ Th√®me appliqu√© ! Regardez les changements dans l'interface."),console.log(""),console.log("üí° Astuce: Testez rapidement plusieurs heures:"),console.log("   testAllHours()  - Affiche l'intensit√© pour toutes les heures"),console.log("   testAdaptiveThemeAt(6)   - Matin (d√©but transition)"),console.log("   testAdaptiveThemeAt(8)   - Matin (milieu)"),console.log("   testAdaptiveThemeAt(14)  - Jour"),console.log("   testAdaptiveThemeAt(18)  - Soir (milieu transition)"),console.log("   testAdaptiveThemeAt(22)  - Nuit")},window.testAllHours=function(){console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"),console.log("üìä INTENSIT√â DU TH√àME ADAPTATIF SUR 24 HEURES"),console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"),console.log("");const e=960;for(let t=0;t<24;t++){const o=60*t;let n,a="",r="";if(o>=360&&o<600){n=1-(o-360)/240,r="üåÖ"}else if(o>=600&&o<e)n=0,r="‚òÄÔ∏è ";else if(o>=e&&o<1200){n=(o-e)/240,r="üåÜ"}else n=1,r="üåô";const i=Math.round(20*n),l=20-i;a="‚ñà".repeat(i)+"‚ñë".repeat(l),console.log(`${r} ${String(t).padStart(2,"0")}h  [${a}] ${n.toFixed(2)}`)}console.log(""),console.log("L√©gende: 0.00 = clair maximum, 1.00 = sombre maximum"),console.log("üåô Nuit  |  üåÖ Transition matin  |  ‚òÄÔ∏è  Jour  |  üåÜ Transition soir"),console.log(""),console.log("üí° Pour tester une heure: testAdaptiveThemeAt(14) ou testAdaptiveThemeAt(18, 30)"),console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")},window.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{$("stylesheet")&&$("stylesheet").href.includes("adaptive.css")&&(console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"),console.log("üé® TH√àME ADAPTATIF ACTIF"),console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"),console.log(""),console.log("üìù Commandes disponibles dans la console:"),console.log(""),console.log("  testAdaptiveThemeAt(14)      - Tester le th√®me √† 14h"),console.log("  testAdaptiveThemeAt(18, 30)  - Tester le th√®me √† 18h30"),console.log("  testAllHours()               - Voir l'intensit√© sur 24h"),console.log(""),console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")),window.progressBar&&progressBar()},500)});